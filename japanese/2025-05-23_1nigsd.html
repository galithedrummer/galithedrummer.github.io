<!DOCTYPE html>
<html lang='ja'>
<head>
  <meta charset='UTF-8'>
  <title>小学校3年生国語テスト（上級）第5回</title>
  <style>
  body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: auto; padding: 20px; }
  h1 { color: #003366; font-size: 28px; }
  .question { margin-bottom: 28px; padding: 16px; border-radius: 12px; background: #fafbff; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
  .question-title { font-weight: bold; font-size: 20px; margin-bottom: 8px; }
  .options label {
    padding-right: 10px;
    display: inline-block;
    margin-right: 40px;
    margin-top: 10px;
    padding: 8px 12px;
    border-radius: 8px;
    border: 2px solid transparent;
    transition: background 0.3s, border 0.3s;
    cursor: pointer;
  }
  .options input[type="radio"]:checked + .opt-prefix + .opt-content {
    background-color: #e0f0ff;
    border-radius: 4px;
  }
  input[type="radio"]:checked + .opt-prefix + .opt-content {
    background-color: #e0f0ff;
    padding: 2px 6px;
    border-radius: 6px;
  }
  .opt-prefix {
    font-size: 14px;
    display: inline-block;
    width: 1.6em;
    text-align: right;
  }
  .opt-content {
    font-size: 20px;
    margin-left: 4px;
    display: inline-block;
  }
  .feedback { margin-top: 8px; }
  .incorrect {
    display: inline-block;
    font-size: 18px;
    background-color: #ffe8e8;
    border: 2px solid #ff4d4f;
    border-radius: 6px;
    padding: 4px 8px;
  }
  #result { font-size: 18px; font-weight: bold; margin-top: 20px; }
</style>
</head>
<body>
  <h1>小学校3年生国語テスト（上級）第5回</h1>
  <form id='quizForm'>
<div class='question'>
<div class='question-title'>1. 「自然」の反対の言葉は？</div>
<div class='options'>
<label><input type='radio' name='q1' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>人工</span></label><label><input type='radio' name='q1' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>自然体</span></label><label><input type='radio' name='q1' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>自然</span></label><label><input type='radio' name='q1' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>人間</span></label></div>
</div>
<div class='question'>
<div class='question-title'>2. 「大切」と近い意味の言葉は？</div>
<div class='options'>
<label><input type='radio' name='q2' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>困難</span></label><label><input type='radio' name='q2' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>重ねる</span></label><label><input type='radio' name='q2' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>有名</span></label><label><input type='radio' name='q2' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>重要</span></label></div>
</div>
<div class='question'>
<div class='question-title'>3. 「動物園で見たもの」の文章でふさわしくないのは？</div>
<div class='options'>
<label><input type='radio' name='q3' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>キリンの首</span></label><label><input type='radio' name='q3' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>ライオンの声</span></label><label><input type='radio' name='q3' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>アイスクリームの味</span></label><label><input type='radio' name='q3' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>ゾウの鼻</span></label></div>
</div>
<div class='question'>
<div class='question-title'>4. 「はなす・話す・放す」の意味の違いを選べ</div>
<div class='options'>
<label><input type='radio' name='q4' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>話す：ことばを使う</span></label><label><input type='radio' name='q4' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>放す：つかまえる</span></label><label><input type='radio' name='q4' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>放す：しまう</span></label><label><input type='radio' name='q4' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>話す：におい</span></label></div>
</div>
<div class='question'>
<div class='question-title'>5. 「走っている」と「歩いている」の共通点は？</div>
<div class='options'>
<label><input type='radio' name='q5' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>名前を表す</span></label><label><input type='radio' name='q5' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>感情を表す</span></label><label><input type='radio' name='q5' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>色を表す</span></label><label><input type='radio' name='q5' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>動作を表す</span></label></div>
</div>
<div class='question'>
<div class='question-title'>6. 「動物園で見たもの」の文章でふさわしくないのは？</div>
<div class='options'>
<label><input type='radio' name='q6' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>ゾウの鼻</span></label><label><input type='radio' name='q6' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>ライオンの声</span></label><label><input type='radio' name='q6' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>キリンの首</span></label><label><input type='radio' name='q6' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>アイスクリームの味</span></label></div>
</div>
<div class='question'>
<div class='question-title'>7. 「あいさつ」が大事な理由は？</div>
<div class='options'>
<label><input type='radio' name='q7' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>気持ちを伝えるから</span></label><label><input type='radio' name='q7' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>道をきれいにする</span></label><label><input type='radio' name='q7' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>声が大きいから</span></label><label><input type='radio' name='q7' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>時間を守るため</span></label></div>
</div>
<div class='question'>
<div class='question-title'>8. 「文章を読む目的」は何か？</div>
<div class='options'>
<label><input type='radio' name='q8' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>書くため</span></label><label><input type='radio' name='q8' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>字の練習</span></label><label><input type='radio' name='q8' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>紙を見る</span></label><label><input type='radio' name='q8' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>内容を理解するため</span></label></div>
</div>
<div class='question'>
<div class='question-title'>9. 「便利」の反対の意味は？</div>
<div class='options'>
<label><input type='radio' name='q9' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>不安</span></label><label><input type='radio' name='q9' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>不明</span></label><label><input type='radio' name='q9' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>不便</span></label><label><input type='radio' name='q9' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>不足</span></label></div>
</div>
<div class='question'>
<div class='question-title'>10. 「朝早く起きること」の長所は？</div>
<div class='options'>
<label><input type='radio' name='q10' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>時間に余裕がある</span></label><label><input type='radio' name='q10' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>遊べない</span></label><label><input type='radio' name='q10' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>眠れない</span></label><label><input type='radio' name='q10' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>朝ごはんがない</span></label></div>
</div>
<div class='question'>
<div class='question-title'>11. 「妹」はどんな人をさす？</div>
<div class='options'>
<label><input type='radio' name='q11' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>自分より年上の女</span></label><label><input type='radio' name='q11' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>自分より年下の女のきょうだい</span></label><label><input type='radio' name='q11' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>父の姉</span></label><label><input type='radio' name='q11' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>友だち</span></label></div>
</div>
<div class='question'>
<div class='question-title'>12. 「走っている」と「歩いている」の共通点は？</div>
<div class='options'>
<label><input type='radio' name='q12' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>動作を表す</span></label><label><input type='radio' name='q12' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>感情を表す</span></label><label><input type='radio' name='q12' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>色を表す</span></label><label><input type='radio' name='q12' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>名前を表す</span></label></div>
</div>
<div class='question'>
<div class='question-title'>13. 「言葉」を使ってできることは？</div>
<div class='options'>
<label><input type='radio' name='q13' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>伝える</span></label><label><input type='radio' name='q13' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>歩く</span></label><label><input type='radio' name='q13' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>書く</span></label><label><input type='radio' name='q13' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>見る</span></label></div>
</div>
<div class='question'>
<div class='question-title'>14. 「彼女は花のように美しい」これは何という表現？</div>
<div class='options'>
<label><input type='radio' name='q14' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>比喩</span></label><label><input type='radio' name='q14' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>体言止め</span></label><label><input type='radio' name='q14' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>直喩</span></label><label><input type='radio' name='q14' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>擬人法</span></label></div>
</div>
<div class='question'>
<div class='question-title'>15. 「読書」の正しい意味は？</div>
<div class='options'>
<label><input type='radio' name='q15' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>文字を書くこと</span></label><label><input type='radio' name='q15' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>文章を作ること</span></label><label><input type='radio' name='q15' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>本を読むこと</span></label><label><input type='radio' name='q15' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>本を買うこと</span></label></div>
</div>
<div class='question'>
<div class='question-title'>16. 「感動した」の意味として正しいのは？</div>
<div class='options'>
<label><input type='radio' name='q16' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>心が止まった</span></label><label><input type='radio' name='q16' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>心がうごいた</span></label><label><input type='radio' name='q16' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>驚いた</span></label><label><input type='radio' name='q16' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>体がうごいた</span></label></div>
</div>
<div class='question'>
<div class='question-title'>17. 「自然」の反対の言葉は？</div>
<div class='options'>
<label><input type='radio' name='q17' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>自然体</span></label><label><input type='radio' name='q17' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>自然</span></label><label><input type='radio' name='q17' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>人工</span></label><label><input type='radio' name='q17' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>人間</span></label></div>
</div>
<div class='question'>
<div class='question-title'>18. 「記念」の意味に最も近いのは？</div>
<div class='options'>
<label><input type='radio' name='q18' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>思い出として残す</span></label><label><input type='radio' name='q18' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>集めること</span></label><label><input type='radio' name='q18' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>忘れること</span></label><label><input type='radio' name='q18' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>急ぐこと</span></label></div>
</div>
<div class='question'>
<div class='question-title'>19. 「話し合い」と「相談」の違いに近いのは？</div>
<div class='options'>
<label><input type='radio' name='q19' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>違いはない</span></label><label><input type='radio' name='q19' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>話し合いは命令</span></label><label><input type='radio' name='q19' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>相談は助けを求める</span></label><label><input type='radio' name='q19' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>同じ意味</span></label></div>
</div>
<div class='question'>
<div class='question-title'>20. 「大切」と近い意味の言葉は？</div>
<div class='options'>
<label><input type='radio' name='q20' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>困難</span></label><label><input type='radio' name='q20' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>有名</span></label><label><input type='radio' name='q20' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>重要</span></label><label><input type='radio' name='q20' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>重ねる</span></label></div>
</div>
<div class='question'>
<div class='question-title'>21. 「あいさつ」が大事な理由は？</div>
<div class='options'>
<label><input type='radio' name='q21' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>気持ちを伝えるから</span></label><label><input type='radio' name='q21' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>声が大きいから</span></label><label><input type='radio' name='q21' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>時間を守るため</span></label><label><input type='radio' name='q21' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>道をきれいにする</span></label></div>
</div>
<div class='question'>
<div class='question-title'>22. 「白い紙に黒いインクで書く」の「黒い」の反対は？</div>
<div class='options'>
<label><input type='radio' name='q22' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>濃い</span></label><label><input type='radio' name='q22' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>青い</span></label><label><input type='radio' name='q22' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>暗い</span></label><label><input type='radio' name='q22' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>白い</span></label></div>
</div>
<div class='question'>
<div class='question-title'>23. 「白い紙に黒いインクで書く」の「黒い」の反対は？</div>
<div class='options'>
<label><input type='radio' name='q23' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>濃い</span></label><label><input type='radio' name='q23' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>白い</span></label><label><input type='radio' name='q23' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>暗い</span></label><label><input type='radio' name='q23' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>青い</span></label></div>
</div>
<div class='question'>
<div class='question-title'>24. 「弟」が登場する話として正しいのは？</div>
<div class='options'>
<label><input type='radio' name='q24' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>魔法のつえ</span></label><label><input type='radio' name='q24' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>兄と弟のけんか</span></label><label><input type='radio' name='q24' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>母の誕生日</span></label><label><input type='radio' name='q24' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>動物の森</span></label></div>
</div>
<div class='question'>
<div class='question-title'>25. 「手紙を書く目的」として最もふさわしいのは？</div>
<div class='options'>
<label><input type='radio' name='q25' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>友だちを選ぶ</span></label><label><input type='radio' name='q25' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>字を練習する</span></label><label><input type='radio' name='q25' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>紙を使う</span></label><label><input type='radio' name='q25' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>思いを伝える</span></label></div>
</div>
<div class='question'>
<div class='question-title'>26. 「動物園で見たもの」の文章でふさわしくないのは？</div>
<div class='options'>
<label><input type='radio' name='q26' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>ライオンの声</span></label><label><input type='radio' name='q26' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>キリンの首</span></label><label><input type='radio' name='q26' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>ゾウの鼻</span></label><label><input type='radio' name='q26' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>アイスクリームの味</span></label></div>
</div>
<div class='question'>
<div class='question-title'>27. 「話し合い」と「相談」の違いに近いのは？</div>
<div class='options'>
<label><input type='radio' name='q27' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>相談は助けを求める</span></label><label><input type='radio' name='q27' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>同じ意味</span></label><label><input type='radio' name='q27' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>違いはない</span></label><label><input type='radio' name='q27' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>話し合いは命令</span></label></div>
</div>
<div class='question'>
<div class='question-title'>28. 「白い紙に黒いインクで書く」の「黒い」の反対は？</div>
<div class='options'>
<label><input type='radio' name='q28' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>青い</span></label><label><input type='radio' name='q28' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>暗い</span></label><label><input type='radio' name='q28' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>白い</span></label><label><input type='radio' name='q28' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>濃い</span></label></div>
</div>
<div class='question'>
<div class='question-title'>29. 「泳ぐ」の送りがなとして正しいのは？</div>
<div class='options'>
<label><input type='radio' name='q29' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>泳き</span></label><label><input type='radio' name='q29' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>泳け</span></label><label><input type='radio' name='q29' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>泳が</span></label><label><input type='radio' name='q29' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>泳ぐ</span></label></div>
</div>
<div class='question'>
<div class='question-title'>30. 「原因」と「結果」の関係に当てはまるのは？</div>
<div class='options'>
<label><input type='radio' name='q30' value='A'> <span class='opt-prefix'>A.</span><span class='opt-content'>勉強した → 本を買う</span></label><label><input type='radio' name='q30' value='B'> <span class='opt-prefix'>B.</span><span class='opt-content'>病院へ行く → けがをした</span></label><label><input type='radio' name='q30' value='C'> <span class='opt-prefix'>C.</span><span class='opt-content'>けがをした → 病院へ行く</span></label><label><input type='radio' name='q30' value='D'> <span class='opt-prefix'>D.</span><span class='opt-content'>本を読んだ → 書く</span></label></div>
</div>
<button type='button' onclick='gradeQuiz()'>提出する</button>
</form>
<div id='result'></div>
<script>
const answers = [
  { num: 1, answer: 'A', correct: '人工' },
  { num: 2, answer: 'D', correct: '重要' },
  { num: 3, answer: 'C', correct: 'アイスクリームの味' },
  { num: 4, answer: 'A', correct: '話す：ことばを使う' },
  { num: 5, answer: 'D', correct: '動作を表す' },
  { num: 6, answer: 'D', correct: 'アイスクリームの味' },
  { num: 7, answer: 'A', correct: '気持ちを伝えるから' },
  { num: 8, answer: 'D', correct: '内容を理解するため' },
  { num: 9, answer: 'C', correct: '不便' },
  { num: 10, answer: 'A', correct: '時間に余裕がある' },
  { num: 11, answer: 'B', correct: '自分より年下の女のきょうだい' },
  { num: 12, answer: 'A', correct: '動作を表す' },
  { num: 13, answer: 'A', correct: '伝える' },
  { num: 14, answer: 'A', correct: '比喩' },
  { num: 15, answer: 'C', correct: '本を読むこと' },
  { num: 16, answer: 'B', correct: '心がうごいた' },
  { num: 17, answer: 'C', correct: '人工' },
  { num: 18, answer: 'A', correct: '思い出として残す' },
  { num: 19, answer: 'C', correct: '相談は助けを求める' },
  { num: 20, answer: 'C', correct: '重要' },
  { num: 21, answer: 'A', correct: '気持ちを伝えるから' },
  { num: 22, answer: 'D', correct: '白い' },
  { num: 23, answer: 'B', correct: '白い' },
  { num: 24, answer: 'B', correct: '兄と弟のけんか' },
  { num: 25, answer: 'D', correct: '思いを伝える' },
  { num: 26, answer: 'D', correct: 'アイスクリームの味' },
  { num: 27, answer: 'A', correct: '相談は助けを求める' },
  { num: 28, answer: 'C', correct: '白い' },
  { num: 29, answer: 'D', correct: '泳ぐ' },
  { num: 30, answer: 'C', correct: 'けがをした → 病院へ行く' },
];

function gradeQuiz() {
  let score = 0;
  document.querySelectorAll(".feedback").forEach(el => el.remove());
  answers.forEach(a => {
    const sel = document.querySelector(`input[name='q${a.num}']:checked`);
    const div = document.querySelectorAll(".question")[a.num - 1];
    if (sel && sel.value === a.answer) {
      score++;
    } else {
      const fb = document.createElement("div");
      fb.className = "feedback";
      fb.innerHTML = "正解は：<span class='incorrect'>" + a.answer + ". " + a.correct + "</span>";
      div.appendChild(fb);
    }
  });
  document.getElementById("result").innerText = `あなたの得点：${score} / ${answers.length}`;

  const key = location.pathname.split('/').pop() || 'default';
  const storageURL = 'https://kvdb.io/FrFWQafq3LwK1bVEhs4ER6/' + key;
  const entry = {
    score: `${score} / ${answers.length}`,
    timestamp: new Date().toISOString()
  };
  fetch(storageURL)
    .then(r => r.ok ? r.text() : "[]")
    .then(t => {
      let data = [];
      try { data = JSON.parse(t); if (!Array.isArray(data)) data = []; } catch (e) { data = []; }
      data.push(entry);
      return fetch(storageURL, {
        method: "PUT",
        body: JSON.stringify(data)
      });
    });
}

window.addEventListener("DOMContentLoaded", () => {
  const popup = document.createElement("div");
  popup.id = "score-popup";
  popup.style = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: #f0f4ff;
    padding: 18px 20px;
    border: 1px solid #ccd;
    font-size: 16px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 999;
    width: 320px;
    font-family: "Segoe UI", sans-serif;
  `;
  popup.innerHTML = `
    <div style="display:flex; justify-content: space-between; align-items: center;">
      <h4 style="margin: 0; font-size: 18px; color: #003366;">過去の成績</h4>
      <button style="background-color:#007bff;color:white;border:none;border-radius:6px;padding:4px 10px;cursor:pointer;font-weight:bold;" onclick="this.parentNode.parentNode.remove()">✖</button>
    </div>
    <hr style="margin:10px 0;border:none;border-top:1px solid #ccc">
    <div id="score-log" style="line-height:1.6">読み込み中...</div>
  `;
  document.body.appendChild(popup);

  const key = location.pathname.split('/').pop() || 'default';
  const storageURL = 'https://kvdb.io/FrFWQafq3LwK1bVEhs4ER6/' + key;
  fetch(storageURL)
    .then(res => res.text())
    .then(t => {
      let entries = JSON.parse(t);
      if (!Array.isArray(entries)) entries = [entries];
      const sorted = entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const log = document.getElementById("score-log");
      log.innerHTML = `<table style="width:100%; border-collapse: collapse;">
        ${sorted.map(e => `
          <tr><td style="padding:6px 4px;"><strong>得点</strong></td><td style="padding:6px 4px;">${e.score}</td></tr>
          <tr><td style="padding:6px 4px;"><strong>時刻</strong></td><td style="padding:6px 4px;">${new Date(e.timestamp).toLocaleString()}</td></tr>
          <tr><td colspan="2"><hr style='border:none;border-top:1px solid #ddd;'></td></tr>
        `).join("")}
      </table>`;
    })
    .catch(() => {
      document.getElementById("score-log").innerText = "記録なし";
    });
});
</script>
</body>
</html>
